generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------------------
// User Model
// -------------------------
model User {
  id           Int       @id @default(autoincrement())
  name         String
  email        String    @unique
  password     String    // store hashed password only
  role         Role      @default(CUSTOMER)
  isActive     Boolean   @default(true)   // deactivate user if needed
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  bookings     Booking[]
  reviews      Review[]
  createdTrips Trip[]    // Trips created by Admin
}

// Enum for user roles
enum Role {
  ADMIN
  CUSTOMER
}

// -------------------------
// Trip Model
// -------------------------
model Trip {
  id             Int       @id @default(autoincrement())
  title          String
  slug           String    @unique
  description    String
  price          Float
  startDate      DateTime
  endDate        DateTime
  seatsAvailable Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  createdBy      User?     @relation(fields: [createdById], references: [id]) // Admin who created trip
  createdById    Int?
  bookings       Booking[]
  reviews        Review[]
}

// -------------------------
// Booking Model
// -------------------------
model Booking {
  id        Int       @id @default(autoincrement())
  user      User      @relation(fields: [userId], references: [id])
  userId    Int
  trip      Trip      @relation(fields: [tripId], references: [id])
  tripId    Int
  status    BookingStatus @default(PENDING)
  bookedAt  DateTime  @default(now())
  payment   Payment?
}

// Booking Status Enum
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// -------------------------
// Payment Model
// -------------------------
model Payment {
  id            Int       @id @default(autoincrement())
  booking       Booking   @relation(fields: [bookingId], references: [id])
  bookingId     Int       @unique
  amount        Float
  paymentMethod PaymentMethod
  status        PaymentStatus @default(PENDING)
  paidAt        DateTime?
}

// Payment Enums
enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  STRIPE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// -------------------------
// Review Model
// -------------------------
model Review {
  id        Int      @id @default(autoincrement())
  tripId    Int
  userId    Int
  rating    Int      @default(5)
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trip Trip @relation(fields: [tripId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([userId, tripId]) // Ek user sirf ek trip ka review de sakta
}
